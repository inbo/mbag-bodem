---
title: "Modelling presence-absence compositional differences"
author: "Hans Van Calster"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    toc: true
    toc_float: true
    code_folding: hide
editor_options:
  markdown:
    wrap: sentence
  chunk_output_type: console
---


```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = TRUE)
library(here)
opts_chunk$set(echo = TRUE, error = TRUE, out.width = "100%")
opts_knit$set(root.dir = here::here())
library(ggplot2)
library(dplyr)
library(tidyr)
library(purrr)
mbag_bodem_folder <- "G:/Gedeelde drives/PRJ_MBAG/4c_bodembiodiversiteit" # nolint
library(gllvm)
library(phyloseq)
```

# Read data

```{r inlezen}
metadata <- readr::read_csv(
  file.path(
    mbag_bodem_folder,
    "data",
    "Stratificatie_MBAG_plots",
    "MBAG_stratfile_v2_cleaned_13.csv"
  )
) %>%
  janitor::clean_names() %>%
  rename(
    ph_kcl = p_h_k_cl,
    swc_grav = sw_cgrav,
    swc_vol = sw_cvol,
    cn_stockbased = c_n_stockbased,
    c_density = cdensity,
    n_density = ndensity
  ) %>%
  mutate(
    landgebruik = factor(
      landgebruik_mbag,
      levels = c(
        "Akker", "Tijdelijk grasland", "Blijvend grasland",
        "Residentieel grasland", "Natuurgrasland", "Heide", "Moeras"
      )
    ),
    diepte = gsub("_|/", "-", diepte) |> factor()
  )
load(
  file.path(
    mbag_bodem_folder,
    "data", "statistiek", "Annelida", "phyloseq",
    "physeq_Olig01_Annelida_species.Rdata"
  )
)
physeq_olig01_annelida_species <- physeq_Olig01_Annelida_species |> # nolint
  phyloseq::subset_samples(
    !Landgebruik_MBAG %in% c("Moeras", "Heide")
  )
```



```{r}
sample_data(physeq_olig01_annelida_species)$Landgebruik_MBAG <- factor(
  sample_data(physeq_olig01_annelida_species)$Landgebruik_MBAG,
  levels = c(
    "Akker", "Tijdelijk grasland", "Blijvend grasland",
    "Residentieel grasland", "Natuurgrasland"
  )
)
```

```{r}
# aggregating to genus
physeq_olig01_annelida_genus <- physeq_olig01_annelida_species |>
  phyloseq::tax_glom(taxrank = "genus")
```



```{r}

```

